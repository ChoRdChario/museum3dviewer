<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LociMyu v6.6</title>

  <!-- import map: three / examples を解決（ESM） -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
    }
  }
  </script>

  <style>
    :root { color-scheme: dark; }
    body { margin:0; background:#0e0f12; color:#dfe6f3; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto; }

    /* レイアウト（左:viewer / 右:サイドパネル） */
    #app { display:grid; grid-template-columns: 1fr 360px; height:100dvh; }
    #viewer { position:relative; overflow:hidden; background:#0b0c0f; }
    #right { border-left:1px solid rgba(255,255,255,.06); padding:10px; overflow:auto; }

    /* タブ */
    .tabs { display:flex; gap:8px; margin-top:8px; }
    .tabs button { padding:6px 10px; border-radius:10px; background:#141821; border:1px solid rgba(255,255,255,.08); color:#dfe6f3; cursor:pointer; }
    .tabs button[aria-selected="true"] { background:#1a2230; border-color:#2c3a52; }

    /* タブ見出しに誤ってUIが入るのを防止（保険・1行） */
    #tab-material > * { display:none !important; }

    /* パネル */
    .panel { margin-top:10px; padding:12px; border:1px solid rgba(255,255,255,.08); border-radius:12px; background:#12161f; }
    .row { display:flex; align-items:center; gap:8px; }
    .row > label { flex:0 0 120px; opacity:.8; }
    .row > select, .row > input[type="range"] { flex:1; }
  </style>
</head>
<body>
  <div id="app">
    <main id="viewer"><!-- three.js canvas を既存スクリプトが挿入 --></main>

    <aside id="right">
      <!-- 上段: URL / Sheets / Load / Signin など既存UI（id/クラスは変更しない） -->
      <div class="row">
        <input id="glbUrl" type="text" placeholder="https://drive.google.com/ ... or GLB URL" style="flex:1" />
        <button id="btnGlb">Load</button>
        <button id="auth-signin">Sign in</button>
      </div>
      <div class="row" style="margin-top:6px; gap:6px">
        <button id="btnSheet1">シート1</button>
        <button id="btnSheet2">シート1</button>
        <button id="btnCreate">Create</button>
      </div>

      <!-- タブ見出し -->
      <div class="tabs" id="tabbar" role="tablist" aria-label="panes">
        <button id="tab-caption"  role="tab" aria-controls="panel-caption"  aria-selected="true">Caption</button>
        <button id="tab-material" role="tab" aria-controls="panel-material" aria-selected="false">Material</button>
        <button id="tab-views"    role="tab" aria-controls="panel-views"    aria-selected="false">Views</button>
      </div>

      <!-- パネル: Caption（中身は既存スクリプトが制御） -->
      <section id="panel-caption" class="panel" role="tabpanel" aria-labelledby="tab-caption">
        <div style="opacity:.7">Caption panel (existing UI remains controlled by app scripts)</div>
      </section>

      <!-- パネル: Material（明示アンカーのみ。見出し側には一切置かない） -->
      <section id="panel-material" class="panel" role="tabpanel" aria-labelledby="tab-material" hidden>
        <div class="row">
          <label for="materialSelect">Select material</label>
          <select id="materialSelect"><option value="">— Select —</option></select>
        </div>
        <div class="row" style="margin-top:8px">
          <label for="opacityRange">Opacity</label>
          <input id="opacityRange" type="range" min="0" max="1" step="0.01" value="1.00" />
        </div>
      </section>

      <!-- パネル: Views（そのまま） -->
      <section id="panel-views" class="panel" role="tabpanel" aria-labelledby="tab-views" hidden>
        <div style="opacity:.7">Views panel</div>
      </section>
    </aside>
  </div>

  <!-- 既存ブート順は維持 -->
  <script type="module" src="./boot.esm.cdn.js"></script>
  <script type="module" src="./material.orchestrator.js"></script>

  <!-- 最小タブ切替 -->
  <script>
    (() => {
      const tabs = [
        ['tab-caption','panel-caption'],
        ['tab-material','panel-material'],
        ['tab-views','panel-views'],
      ];
      function show(id) {
        for (const [t,p] of tabs) {
          const tb = document.getElementById(t), pn = document.getElementById(p);
          const on = (p===id);
          tb.setAttribute('aria-selected', on ? 'true':'false');
          pn.hidden = !on;
        }
      }
      for (const [t,p] of tabs) {
        document.getElementById(t).addEventListener('click', () => show(p));
      }
      show('panel-caption');
    })();
  </script>
</body>
</html>
