<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LociMyu — 3D+Caption Tool</title>

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 16 16%27%3E%3Ccircle cx=%228%22 cy=%228%22 r=%228%22 fill=%22%236ea8fe%22/%3E%3Ctext x=%228%22 y=%2211%22 font-size=%2210%22 text-anchor=%22middle%22 fill=%22%230b1220%22%3EL%3C/text%3E%3C/svg%3E" />

  <link rel="stylesheet" href="css/styles.css" />

  <!-- three.js importmap -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <!-- デバッグUI -->
  <style>
    #locimyu-badge{position:fixed;left:8px;bottom:8px;background:#51cf66;color:#0b1f12;padding:6px 10px;border-radius:999px;font:12px/1 ui-sans-serif,system-ui;box-shadow:0 2px 10px #0006;display:none;z-index:99998}
    #locimyu-debug{position:fixed;right:8px;bottom:8px;background:#111c;color:#fff;border:1px solid #444;border-radius:8px;font:12px/1.4 ui-monospace,Menlo,Consolas,monospace;padding:6px 8px;max-width:50vw;max-height:35vh;overflow:auto;display:none;z-index:99999}
  </style>
</head>
<body>
  <!-- デバッグ表示 -->
  <div id="locimyu-badge">READY</div>
  <div id="locimyu-debug"><b>Debug</b><div id="locimyu-log"></div></div>
  <script>
    (function(){
      const badge=document.getElementById('locimyu-badge');
      const box=document.getElementById('locimyu-debug');
      const logEl=document.getElementById('locimyu-log');
      function log(msg){
        box.style.display='block';
        const d=document.createElement('div');
        d.textContent=msg;
        logEl.appendChild(d);
      }
      // ★ setStatus を追加
      function setStatus(msg){
        badge.textContent = msg || "READY";
        badge.style.display='inline-block';
      }

      window.__LMY = { showBadge(){ badge.style.display='inline-block'; }, log, setStatus };

      window.addEventListener('error', e=>log('[window.error] '+(e.message||e.error)));
      window.addEventListener('unhandledrejection', e=>log('[unhandled] '+(e.reason&&e.reason.message||e.reason)));
    })();
  </script>

  <header class="topbar">
    <div class="brand">LociMyu</div>
    <nav class="top-actions">
      <button id="signinBtn" class="btn primary">Googleにサインイン</button>
      <button id="signoutBtn" class="btn" disabled>サインアウト</button>
      <a id="manualLink" class="btn link" href="#" target="_blank">マニュアルPDF</a>
      <button id="readonlyLinkBtn" class="btn" title="閲覧専用URLをコピー">閲覧専用リンク</button>
    </nav>
  </header>

  <main class="layout">
    <section id="viewerPane" class="viewer-pane">
      <div id="viewer" class="viewer"></div>
      <div id="loadingOverlay" class="overlay hidden">
        <div class="spinner"></div>
        <div class="overlay-text">読み込み中...</div>
      </div>
    </section>

    <aside id="deskPane" class="desk-pane">
      <!-- ここに各種UI（マテリアル・カメラ・キャプション等）が入ります -->
    </aside>
  </main>

  <footer class="bottombar mobile-only">
    <button id="mobileHome" class="btn small">ホーム</button>
    <button id="mobileMaterials" class="btn small">マテ</button>
    <button id="mobileCamera" class="btn small">カメラ</button>
    <button id="mobileCaptions" class="btn small">キャプ</button>
  </footer>

  <!-- アプリ設定 -->
  <script>
    window.__LOCIMYU_CONFIG__ = {
      apiKey: "AIzaSyCUnTCr5yWUWPdEXST9bKP1LpgawU5rIbI",
      clientId: "595200751510-ncahnf7edci6b9925becn5to49r6cguv.apps.googleusercontent.com",
      spreadsheetTitleSuffix: "__LociMyu",
      manualPdfPath: "manual.pdf",
      readOnlyParam: "readonly"
    };
  </script>

  <!-- 依存スクリプト -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
  <script src="https://unpkg.com/heic2any@0.0.4/dist/heic2any.min.js"></script>

  <!-- エントリーポイント -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
