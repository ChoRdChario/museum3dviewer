<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LociMyu v6.6</title>
  <style>
    body{margin:0;background:#0f1012;color:#e8e8ea;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    #app{display:grid;grid-template-columns:1fr 360px;gap:0;height:100vh}
    #viewer{background:#0b0c0e}
    #right{background:#121316;border-left:1px solid #24262c;overflow:auto}
    .tabs{display:flex;gap:.5rem;padding:.5rem .75rem;border-bottom:1px solid #24262c;position:sticky;top:0;background:#121316;z-index:2}
    .tabs>button{background:#1a1c22;border:1px solid #2b2e36;color:#e8e8ea;padding:.35rem .6rem;border-radius:.4rem;cursor:pointer}
    .tabs>button[aria-selected="true"]{background:#22252d;border-color:#3b3f49}
    .card{margin:.75rem;padding:.75rem;border:1px solid #24262c;border-radius:.6rem;background:#14161a}
    .field{margin:.75rem 0}
    .label{display:block;font-size:.9rem;margin-bottom:.4rem;color:#cfd1d6}
    input[type="range"]{width:100%}
    small{opacity:.65}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
  </style>
</head>
<body>
  <div id="app">
    <main id="viewer" aria-label="3D Viewer"></main>
    <aside id="right">
      <div class="topbar card" style="display:flex;align-items:center;gap:.5rem;">
        <input id="glbUrl" type="text" placeholder="https://drive.google.com/... or GLB URL" style="flex:1;min-width:0;">
        <button id="btnGlb">Load</button>
        <button id="auth-signin">Sign in</button>
      </div>

      <nav class="tabs" role="tablist" aria-label="Panels">
        <button id="tab-caption" role="tab" aria-selected="true" aria-controls="pane-caption">Caption</button>
        <button id="tab-material" role="tab" aria-selected="false" aria-controls="pane-material">Material</button>
        <button id="tab-views" role="tab" aria-selected="false" aria-controls="pane-views">Views</button>
      </nav>

      <!-- Caption pane (既存アプリが制御) -->
      <section id="pane-caption" role="tabpanel" aria-labelledby="tab-caption" class="card">
        <div>Caption panel (existing UI remains controlled by app scripts)</div>
      </section>

      <!-- Material pane: ★ orchestrator はここだけを見る -->
      <section id="pane-material" role="tabpanel" aria-labelledby="tab-material" class="card" hidden>
        <div class="field">
          <label for="materialSelect" class="label">Per-material opacity (saved per sheet)</label>
          <select id="materialSelect">
            <option value="">— Select —</option>
          </select>
        </div>

        <div class="field">
          <input id="opacityRange" type="range" min="0" max="1" step="0.01" value="1.0" />
          <small>This does not change global opacity above.</small>
        </div>

        <fieldset class="field">
          <legend>Shading</legend>
          <label><input type="checkbox" id="doubleSided" /> Double-sided</label>
          <label style="margin-left:1rem;"><input type="checkbox" id="unlitLike" /> Unlit-like</label>
        </fieldset>

        <fieldset class="field">
          <legend>Chroma key</legend>
          <label><input type="checkbox" id="ckEnable" /> Enable</label>
          <div class="row">
            <label>Tolerance <input type="range" min="0" max="1" step="0.01" value="0.5" /></label>
            <label>Feather   <input type="range" min="0" max="1" step="0.01" value="0.5" /></label>
          </div>
        </fieldset>
      </section>

      <section id="pane-views" role="tabpanel" aria-labelledby="tab-views" class="card" hidden>
        <div>Views panel</div>
      </section>
    </aside>
  </div>

  <!-- Minimal tab switcher (no framework): does not touch panel markup -->
  <script>
    (function(){
      const buttons=[
        ["tab-caption","pane-caption"],
        ["tab-material","pane-material"],
        ["tab-views","pane-views"],
      ];
      function sel(id){return document.getElementById(id)}
      function act(tid,pid){
        buttons.forEach(([tb,pn])=>{
          const T=sel(tb), P=sel(pn);
          const on = (tb===tid);
          T.setAttribute("aria-selected", on?"true":"false");
          P.hidden = !on;
        });
      }
      buttons.forEach(([tb,pn],i)=>{
        sel(tb)?.addEventListener("click", ()=>act(tb,pn));
      });
      act("tab-caption","pane-caption"); // default
    })();
  </script>

  <!-- Your existing app bundle (unchanged) -->
  <script type="module" src="boot.esm.cdn.js"></script>
  <!-- Minimal, side-effect free orchestrator -->
  <script src="material.orchestrator.js"></script>
</body>
</html>
