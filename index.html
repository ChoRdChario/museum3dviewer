<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>LociMyu v6.6.3 — Auth & Loading (Dark)</title>
  <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./assets/base.css" />
</head>
<body>
  <!-- Auth floating chip container -->
  <div id="auth-bar"></div>

  <!-- Right panel (kept for PR2 UI injection) -->
  <aside id="side" aria-label="Right pane">
    <h2>LociMyu</h2>
    <div id="auth-box-side" class="section"></div>
    <div class="section small">このペインはPR2以降で本機能UIが入ります。</div>
  </aside>

  <main>
    <h1>LociMyu — PR1 スモーク</h1>
    <p class="hint">この段階ではサインインUIとローディングUI（スピナー/トースト）の骨組みのみ。</p>
    <div style="display:flex; gap:10px">
      <button id="btnTestSpinner">テスト: スピナー2秒</button>
      <button id="btnTestToast">テスト: トースト</button>
    </div>
  </main>

  <script type="module">
    import { ensureLoaded, initAuthUI, isSignedIn } from './features/auth.js';
    import { showSpinner, hideSpinner, toast } from './features/loading.js';
    import { setAuthed } from './features/state.js';

    async function boot() {
      showSpinner('auth');
      try {
        await ensureLoaded();
        initAuthUI();
        setAuthed(isSignedIn());
        toast.info('Auth scripts loaded.');
      } catch (e) {
        console.error(e);
        toast.error('Auth init failed. Check console.');
      } finally {
        hideSpinner();
      }
    }

    document.getElementById('btnTestSpinner').addEventListener('click', () => {
      showSpinner('test'); setTimeout(hideSpinner, 2000);
    });
    document.getElementById('btnTestToast').addEventListener('click', () => {
      toast.success('保存に成功しました（デモ）');
    });

    boot();
  </script>
</body>
</html>
