<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LociMyu v6.6 (material-panel anchor fix)</title>
  <style>
    :root { color-scheme: dark; }
    body{margin:0;background:#0d0f13;color:#e7e9ee;font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
    .app{display:grid;grid-template-columns:1fr 380px;min-height:100vh;}
    #viewer{position:relative;background:#0b0d11;}
    #right{border-left:1px solid #1e2330;background:#0f1218;padding:12px 12px 24px;overflow:auto;}
    /* Tabs */
    .tabs-nav{display:flex;gap:8px;margin:10px 0 6px;position:relative;z-index:1}
    .tabs-nav button{appearance:none;border:1px solid #2a3142;background:#121722;color:#c9d1e1;padding:8px 10px;border-radius:10px;cursor:pointer}
    .tabs-nav button.active{background:#1a2131;border-color:#3a4761}
    .tabs-panels{position:relative}
    .panel{display:none}
    .panel.active{display:block}
    /* Card */
    .card{border:1px solid #253047;background:#0f141e;border-radius:12px;padding:12px;margin:8px 0}
    .row{display:flex;align-items:center;gap:8px}
    select, input[type="range"], input[type="text"]{width:100%}
    /* ---- Material panel anchors ---- */
    #panel-material #mat-controls{display:grid;gap:10px}
    #panel-material #mat-global-opacity{margin-top:8px}
    /* Prevent anything from rendering inside the tab button area */
    #tab-material > *:not(button){display:none!important}
  </style>
</head>
<body>
  <div class="app">
    <main id="viewer"><!-- three.js canvas --></main>
    <aside id="right">
      <header class="card">
        <div class="row" style="gap:6px">
          <input id="glbUrl" type="text" placeholder="https://drive.google.com/... or GLB URL"/>
          <button id="btnGlb">Load</button>
          <button id="auth-signin">Sign in</button>
        </div>
        <div class="row" style="gap:6px;margin-top:6px">
          <button id="btnSheetA">シート1</button>
          <button id="btnSheetB">シート1</button>
          <button id="btnSheetCreate">Create</button>
        </div>
      </header>

      <!-- Tabs -->
      <nav class="tabs-nav" id="tabs">
        <button id="tab-caption" class="active">Caption</button>
        <button id="tab-material">Material</button>
        <button id="tab-views">Views</button>
      </nav>

      <!-- Panels -->
      <section class="tabs-panels">
        <section id="panel-caption" class="panel active">
          <div class="card">Caption panel (existing UI remains controlled by app scripts)</div>
        </section>

        <section id="panel-material" class="panel">
          <!-- PURE ANCHORS inside the panel for material controls -->
          <div id="mat-controls" class="card">
            <label class="row">
              <span style="min-width:120px">Per‑material opacity</span>
              <select id="materialSelect" aria-label="Select material">
                <option value="">— Select —</option>
              </select>
            </label>
            <input id="opacityRange" type="range" min="0" max="1" step="0.01" value="1.00"/>
          </div>

          <div id="mat-global-opacity" class="card">
            <small>This UI is the official anchor area inside the Material panel. No elements are mounted on the tab button.</small>
          </div>

          <div class="card">
            <fieldset>
              <legend>Shading</legend>
              <label><input type="checkbox" id="doubleSided"/> Double‑sided</label>
              <label><input type="checkbox" id="unlitLike"/> Unlit‑like</label>
            </fieldset>
          </div>

          <div class="card">
            <fieldset>
              <legend>Chroma key</legend>
              <label class="row"><input type="checkbox" id="ckEnable"/> Enable <button type="button" id="ckPick">—</button></label>
              <label>Tolerance <input type="range" id="ckTol" min="0" max="1" step="0.01" value="0.3"/></label>
              <label>Feather <input type="range" id="ckFeather" min="0" max="1" step="0.01" value="0.2"/></label>
            </fieldset>
          </div>
        </section>

        <section id="panel-views" class="panel">
          <div class="card">Views panel</div>
        </section>
      </section>

    </aside>
  </div>

  <script>
    // extremely small tab switcher to keep DOM consistent with anchors
    const tabs=[
      ['tab-caption','panel-caption'],
      ['tab-material','panel-material'],
      ['tab-views','panel-views']
    ];
    for (const [btnId,panelId] of tabs){
      const btn=document.getElementById(btnId);
      btn?.addEventListener('click', ()=>{
        document.querySelectorAll('.tabs-nav button').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(panelId)?.classList.add('active');
      });
    }
  </script>

  <!-- Existing app scripts (unchanged order) -->
  <script type="module" src="./boot.esm.cdn.js"></script>
  <script type="module" src="./material.orchestrator.js"></script>
</body>
</html>
