<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LociMyu v6.6</title>
  <link rel="icon" href="./favicon.ico"/>

  <!-- Import map must be defined BEFORE any module that imports 'three' -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
    }
  }
  </script>

  <style>
    :root{
      --line:#2a2a2a;
      --fg:#ddd;
      --muted:#9aa0a6;
      --pad:10px;
      --gap:10px;
    }
    html,body{height:100%;}
    body{margin:0;background:#111;color:var(--fg);font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    #app{display:grid;grid-template-columns:1fr min(420px, 38vw);height:100vh;}
    #gl{width:100%;height:100%;display:block;background:#0e0e10;}
    #ui{border-left:1px solid var(--line);display:flex;flex-direction:column;min-width:300px;}

    header{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid var(--line);}
    header #brand{font-weight:600;color:#eaeaea}
    header .row{display:flex;gap:6px;align-items:center;margin-left:auto}

    .tabs{display:flex;border-bottom:1px solid var(--line);}
    .tabs button{flex:0 0 auto;padding:10px 14px;background:transparent;border:0;border-right:1px solid var(--line);color:var(--muted);cursor:pointer}
    .tabs button[data-selected="true"]{color:#fff;background:#191919}

    .pane{display:none;padding:12px;overflow:auto}
    .pane[data-active="true"]{display:block}

    /* Material section layout */
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .row > .grow{flex:1 1 160px}
    .subtle{color:var(--muted);font-size:12px}
    .hr{height:1px;background:var(--line);margin:8px 0}

    input[type="range"]{width:240px;max-width:45vw}
    select{max-width:240px}
    .kv{display:grid;grid-template-columns:auto 1fr;gap:10px 12px;align-items:center}

    /* Chroma group: prevent horizontal scroll on narrow panes */
    .chroma-wrap{display:grid;grid-template-columns: minmax(90px,auto) 1fr; gap:10px 12px;align-items:center}
    .chroma-controls{display:flex;gap:18px;flex-wrap:wrap}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border:1px solid var(--line);border-radius:8px;background:#171717}
    .val{min-width:2.5ch;text-align:right;font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
  <div id="app">
    <div id="stage"><canvas id="gl"></canvas></div>

    <aside id="ui">
      <header>
        <div id="brand">LociMyu v6.6</div>
        <div class="row">
          <input id="glbUrl" type="text" placeholder="Drive fileId / GLB URL" class="grow"/>
          <button id="btnLoad">Load</button>
        </div>
        <div class="row">
          <select id="save-target-sheet"><option value="">Select sheet…</option></select>
          <button id="save-target-create">Create</button>
        </div>
      </header>

      <nav class="tabs" role="tablist">
        <button id="tab-caption" role="tab" aria-selected="false" data-tab="caption">Caption</button>
        <button id="tab-material" role="tab" aria-selected="true" data-tab="material">Material</button>
        <button id="tab-views" role="tab" aria-selected="false" data-tab="views">Views</button>
      </nav>

      <section id="pane-caption" class="pane" data-tab="caption"></section>

      <section id="pane-material" class="pane" data-tab="material" data-active="true">
        <div class="row">
          <label class="chip"><input id="unlit" type="checkbox"/> Unlit</label>
          <label class="chip"><input id="double" type="checkbox"/> Double-sided</label>
        </div>

        <div class="row" style="margin-top:6px">
          <div class="chip">Opacity</div>
          <input id="opacity-range" type="range" min="0" max="1" step="0.01" value="1" />
          <div id="opacity-val" class="val">1.00</div>
        </div>

        <div class="row">
          <label class="chip"><input id="white-to-alpha" type="checkbox"/> White → Alpha</label>
        </div>

        <div class="hr"></div>

        <div class="kv">
          <div class="subtle">Per-material opacity (saved per sheet)</div>
          <div></div>

          <select id="pm-material" class="grow">
            <option value="">— Select material —</option>
          </select>
          <div class="row">
            <input id="pm-opacity-range" type="range" min="0" max="1" step="0.01" value="1"/>
            <div id="pm-opacity-val" class="val">1.00</div>
          </div>
        </div>

        <p class="subtle">Pick a material, then set its opacity. This does not change global opacity above.</p>

        <div class="hr"></div>

        <!-- Chroma key group -->
        <label class="chip" style="margin-bottom:6px;">
          <input id="ck-enabled" type="checkbox"/> Chroma key
        </label>
        <div class="chroma-wrap">
          <div class="subtle">Key color</div>
          <div class="chroma-controls">
            <input id="ck-color" type="color" value="#00FF00" aria-label="Key color"/>
            <div class="row">
              <div class="subtle" style="min-width:70px;">Tolerance</div>
              <input id="ck-tolerance" type="range" min="0" max="1" step="0.01" value="0.00"/>
              <div id="ck-tolerance-val" class="val">0.00</div>
            </div>
            <div class="row">
              <div class="subtle" style="min-width:70px;">Feather</div>
              <input id="ck-feather" type="range" min="0" max="1" step="0.01" value="0.00"/>
              <div id="ck-feather-val" class="val">0.00</div>
            </div>
          </div>
        </div>

      </section>

      <section id="pane-views" class="pane" data-tab="views"></section>
    </aside>
  </div>

  <!-- App boot first -->
  <script type="module" src="./boot.esm.cdn.js"></script>
  <!-- Material UI orchestrator (wires controls, listens for events) -->
  <script type="module" src="./material.ui.orch.js"></script>
  <!-- Bridge that dispatches lm:scene-ready / lm:model-ready -->
  <script type="module" src="./viewer.bridge.module.js"></script>
</body>
</html>
