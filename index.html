<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>LociMyu v6.6.3 (PR1)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin: 0; }
    #auth-bar { position: fixed; top: 10px; right: 12px; z-index: 1000; }
    #side { position: fixed; top: 0; right: 0; width: 320px; height: 100vh; overflow: auto; padding: 12px; box-sizing: border-box; }
    main { padding: 16px; }
    .hint { color:#666; font-size: 14px; }
  </style>
</head>
<body>
  <!-- 必須の容器 -->
  <div id="auth-bar"></div>
  <div id="side">
    <div id="auth-box-side"></div>
    <div class="hint">ここは右ペイン（暫定）。PR2以降で本UIが入ります。</div>
  </div>
  <main>
    <h1>LociMyu — PR1 スモーク</h1>
    <p class="hint">この段階ではサインインUIとローディングUI（スピナー/トースト）の骨組みのみ。</p>
    <button id="btnTestSpinner">テスト: スピナー2秒</button>
    <button id="btnTestToast">テスト: トースト</button>
  </main>

  <script type="module">
    import { ensureLoaded, initAuthUI, isSignedIn } from './features/auth.js';
    import { showSpinner, hideSpinner, toast } from './features/loading.js';
    import { setAuthed, bus } from './features/state.js';

    async function boot() {
      showSpinner('auth');
      try {
        await ensureLoaded();
        initAuthUI();
        // 初期認証状態をstateに反映
        setAuthed(isSignedIn());
        toast.info('Auth scripts loaded.');
      } catch (e) {
        console.error(e);
        toast.error('Auth init failed. Check console.');
      } finally {
        hideSpinner();
      }

      // auth.js が CustomEvent を投げる想定ならここで捕捉する設計にしてもOK。
      // 今は state.js からの通知のみを利用。
    }

    // Demo buttons
    document.getElementById('btnTestSpinner').addEventListener('click', async () => {
      showSpinner('test');
      setTimeout(hideSpinner, 2000);
    });
    document.getElementById('btnTestToast').addEventListener('click', () => {
      toast.success('保存に成功しました（デモ）');
    });

    boot();
    // デバッグ補助を露出
    window.__LMY = { toast, showSpinner, hideSpinner };
  </script>
</body>
</html>
